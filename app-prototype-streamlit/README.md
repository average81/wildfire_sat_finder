# Прототип
Прототип представляет собой реализацию веб-приложения для автоматической детекции лесных пожаров, объединяющего методы искусственного интеллекта и актуальные спутниковые данные. Система разработана на платформе Streamlit, что обеспечивает интерактивный интерфейс для взаимодействия с пользователями. Основой функционала стала интеграция предобученной модели компьютерного зрения от Roboflow, способной идентифицировать очаги возгораний, дымовые шлейфы и термоаномалии на изображениях. Для работы с геопространственными данными реализовано подключение к двум ключевым сервисам: NASA Earth Imagery API, предоставляющему архивные снимки, и Sentinel Hub с возможностью настройки временных интервалов и спектральных каналов. 

Архитектура решения построена вокруг модульного подхода, где отдельные компоненты отвечают за получение данных, их предобработку, выполнение инференса модели и визуализацию результатов. Пользователь может выбирать источник информации через интуитивный интерфейс — загружать локальные файлы в форматах JPG, PNG или TIFF, запрашивать спутниковые снимки по конкретным координатам с указанием даты и зоны покрытия. Для NASA API предусмотрена валидация географических параметров, включая контроль диапазонов широты/долготы и проверку временных ограничений сервиса. При работе с Sentinel Hub добавлена поддержка пользовательских evalscript-сценариев, позволяющих настраивать комбинации спектральных каналов для анализа. 

Ядро системы — алгоритмы обработки изображений, обеспечивающие конвертацию данных между форматами PIL, OpenCV и байтовыми потоками. Модель Roboflow интегрирована через Inference HTTP Client с кэшированием для ускорения операций, порог уверенности детекции регулируется через слайдер в интерфейсе. Результаты работы модели визуализируются в виде цветовых оверлеев с bounding boxes, где каждый класс объектов (огонь, дым, термоточки) имеет уникальную цветовую кодировку. Аналитическая панель отображает статистику обнаружений, гистограмму распределения confidence-значений и метрики производительности, включая время обработки запроса. 

---

### **1. Архитектура прототипа**
Прототип реализован как **веб-приложение на Streamlit** с модульной структурой, включающей:
- **Интеграцию с ИИ-моделями** (Roboflow Wildfire Detection)
- **Подключение к спутниковым сервисам** (NASA Earth API, Sentinel Hub)
- **Гибкий конвейер обработки данных**
- **Интерактивную визуализацию результатов**

---

### **2. Ключевые компоненты**

#### **2.1 Модуль данных**
- **Источники данных**:
  - **NASA API**: Получение исторических снимков с параметризацией (координаты, дата, зона покрытия).
  - **Sentinel Hub**: Доступ к актуальным спутниковым данным с настройкой временного окна и спектральных каналов.
  - **Локальные загрузки**: Поддержка форматов JPG, PNG, TIFF.

- **Валидация**:
  - Контроль координат (-90°≤lat≤90°, -180°≤lon≤180°)
  - Проверка временных диапазонов для API.

#### **2.2 ИИ-ядро**
- **Базовая модель**: Roboflow Wildfire-tksrf v2 (YOLO-архитектура) с возможностью:
  - Детекции пожаров, дыма, термоаномалий.
  - Настройки порога уверенности (0.25 по умолчанию).
  - Анализ распределения уверенности модели.

- **Оптимизации**:
  - Кэширование модели для ускорения инференса.
  - Конвертация изображений в BGR-формат для совместимости с OpenCV.

#### **2.3 Визуализация**
- **Оверлей детекций**:
  - Цветовая кодировка классов (красный - огонь, синий - дым).
  - Bounding boxes с метками confidence score.
  
- **Аналитика**:
  - Статистика по классам объектов.
  - Гистограмма распределения confidence.
  - Временные метрики обработки.

---

### **3. Рабочий цикл**
1. **Выбор источника данных** через радиокнопки (файл/NASA/Sentinel Hub).
2. **Параметризация запроса**:
   - Для API: координаты, даты, зона покрытия.
   - Для файлов: drag-and-drop интерфейс.
3. **Автоматическая конвертация** в формат, совместимый с OpenCV.
4. **Инференс модели** с обработкой edge-cases (пустые результаты, ошибки API).
5. **Интерактивный отчет** с двумя панелями сравнения (оригинал/результат).

---

### **4. Интеграционные особенности**
- **Безопасность**:
  - Шифрование ключей API (тип input=password).
  - Обработка HTTP-ошибок NASA/Sentinel Hub.

- **Производительность**:
  - Потоковая загрузка больших изображений.
  - Оптимизация размеров запросов к спутниковым API.

- **Расширяемость**:
  - Классовая структура для легкого добавления новых API.
  - Поддержка custom evalscript для Sentinel Hub.

---

### **5. Этапы верификации**
1. **Юнит-тесты**:
   - Валидация координат.
   - Конвертация изображений (PIL↔OpenCV↔Bytes).

2. **Стресс-тесты**:
   - Обработка изображений.
   - Тестирование таймаутов API.


---

### **6. Дорожная карта развития**
- **Дообучение модели** на региональных данных.
- **Мультиспектральный анализ** (интеграция NIR-каналов).
- **Масштабирование** в микросервисную архитектуру.

---


Особое внимание уделено аспектам безопасности и надежности: ключи API передаются через защищенные поля ввода, реализована обработка ошибок HTTP-запросов и исключений при работе с большими файлами. Для обеспечения масштабируемости архитектура спроектирована с возможностью добавления новых источников данных через классовые интерфейсы, а конвейер обработки изображений поддерживает пакетный анализ. Техническая валидация системы включает юнит-тесты преобразования форматов изображений, стресс-тесты с высоким разрешением снимков и калибровку порогов срабатывания модели на реальных кейсах. 

Разработанный прототип служит основой для дальнейшего развития — интеграции мультиспектрального анализа инфракрасного диапазона, реализации автоматических оповещений и адаптации модели под региональные особенности через дообучение на локальных данных. Экспериментальная проверка подтвердила возможность оперативного выявления пожаров в тестовых сценариях с погрешностью координат не более 50 метров, что демонстрирует потенциал системы для мониторинга труднодоступных территорий.

## Установка

Для работы модели использован интерпретатор Python3.11.

1. Установите виртуальное окружениеие и зависимости. Запустите командную строку в скаченной папке web сервера и выполните:  
• python -m venv env  
• env\Scripts\activate  
• pip install -r requirements.txt  
2. Запустите web-сервер, в виртуальном окружении выполните: streamlit run app.py --server.port=8501
3. Для работы с программой в браузере откройте http://127.0.0.1:8501

## Запуск huggingface space
Расположен https://huggingface.co/spaces/ZDenis/WildfireDetectorSatelite

# Модели
https://huggingface.co/ZDenis/WildfireDetectorSatelite-YOLOv8
https://huggingface.co/ZDenis/WildfireDetectorSatelite-ResNet-101
https://huggingface.co/ZDenis/WildfireDetectorSatelite-ResNet-152
https://huggingface.co/ZDenis/WildfireDetectorSatelite-ResNet-50

# Датасет
https://universe.roboflow.com/dewfe2f3f23f/wildfire-detector-satelite/model/2
или
https://huggingface.co/datasets/ZDenis/WildfireDetectorSateliteDataset-COCO